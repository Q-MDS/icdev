https://192.168.10.239/booking/tv_route/managedebtors.phtml?stage=1&acode=0007
https://secure.intercape.co.za/booking/usermanage/managedebtors.phtml?stage=1&acode=0007



Create DEBTORS_INFO


  CREATE TABLE "ICAPE"."DEBTORS_INFO" 
   (	"COMPANY_NAME" VARCHAR2(50 BYTE) COLLATE "USING_NLS_COMP", 
	"IS_DEALER" CHAR(1 BYTE) COLLATE "USING_NLS_COMP", 
	"ACCOUNT_CODE" VARCHAR2(6 BYTE) COLLATE "USING_NLS_COMP", 
	"POSTAL_ADDRESS" VARCHAR2(200 BYTE) COLLATE "USING_NLS_COMP", 
	"STATEMENT_EMAIL" VARCHAR2(200 BYTE) COLLATE "USING_NLS_COMP", 
	"STATEMENT_FAX" VARCHAR2(20 BYTE) COLLATE "USING_NLS_COMP", 
	"STATEMENT_DELIVERY" CHAR(1 BYTE) COLLATE "USING_NLS_COMP", 
	"COMMISSION" NUMBER, 
	"DAYS_TO_PAY" NUMBER, 
	"M_CURRENCY" VARCHAR2(20 BYTE) COLLATE "USING_NLS_COMP" CONSTRAINT "ICAPE_C007738" NOT NULL ENABLE, 
	"LAST_CLOSE_BALANCE" NUMBER, 
	"LAST_CLOSE_CURRENCY" VARCHAR2(20 BYTE) COLLATE "USING_NLS_COMP", 
	"LAST_CLOSE_MONTH" NUMBER, 
	"COMMISSION_BUDGETLINER" NUMBER, 
	"COMMISSION_SLEEPLINER" NUMBER, 
	"CONTROLLER" CHAR(1 BYTE) COLLATE "USING_NLS_COMP" DEFAULT 'A' CONSTRAINT "ICAPE_C007739" NOT NULL ENABLE, 
	"COUNTRY" CHAR(1 BYTE) COLLATE "USING_NLS_COMP" DEFAULT 'S', 
	"EXPORT_DEBTORS" CHAR(1 BYTE) COLLATE "USING_NLS_COMP" DEFAULT 'Y', 
	"IS_CURRENT" CHAR(1 BYTE) COLLATE "USING_NLS_COMP" DEFAULT 'Y', 
	"VAT_NUMBER" VARCHAR2(20 BYTE) COLLATE "USING_NLS_COMP", 
	"DEBTOR_TYPE" CHAR(1 BYTE) COLLATE "USING_NLS_COMP" DEFAULT 'B', 
	"BILLING_PERIOD" CHAR(1 BYTE) COLLATE "USING_NLS_COMP" DEFAULT 'M', 
	"STATEMENT_DETAILS" CHAR(1 BYTE) COLLATE "USING_NLS_COMP" DEFAULT 'N', 
	"ACC_CONTACT_PERSON" VARCHAR2(40 BYTE) COLLATE "USING_NLS_COMP", 
	"DATE_CREATED" DATE, 
	"RELATED_PARTY" CHAR(1 BYTE) COLLATE "USING_NLS_COMP" DEFAULT 'N' CONSTRAINT "ICAPE_C007740" NOT NULL ENABLE, 
	"LAST_UPDATED" DATE, 
	"LAST_SYNC" DATE, 
	"SAGE_SITE" VARCHAR2(5 BYTE) COLLATE "USING_NLS_COMP", 
	"CC_ACCOUNT_NO" VARCHAR2(6 BYTE) COLLATE "USING_NLS_COMP", 
	"COMMISSION_BAGGAGE" NUMBER DEFAULT 0, 
	"INV_CUTOFF" VARCHAR2(40 BYTE) COLLATE "USING_NLS_COMP", 
	"TERMS" NUMBER, 
	"CREDIT_LIMIT" NUMBER, 
	"PAYMENT_DATE" VARCHAR2(10 BYTE) COLLATE "USING_NLS_COMP", 
	"CUTOFF_DAY" NUMBER, 
	"PAYMENT_DAY" NUMBER, 
	"NORMAL_LIMIT_APPROVED_BY" NUMBER, 
	"SPECIAL_CREDIT_LIMIT" NUMBER DEFAULT 0, 
	"SPECIAL_LIMIT_APPROVED_BY" NUMBER, 
	"SPECIAL_LIMIT_EXPIRY_DATE" NUMBER, 
	"SHOPPING_BASKET_RESTRICTION" CHAR(1 BYTE) COLLATE "USING_NLS_COMP" DEFAULT 'N', 
	"STATEMENT_REMINDER" CHAR(1 BYTE) COLLATE "USING_NLS_COMP" DEFAULT 'Y', 
	 SUPPLEMENTAL LOG DATA (PRIMARY KEY) COLUMNS
   )  DEFAULT COLLATION "USING_NLS_COMP" SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 32768 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "ICAPE" ;
  CREATE UNIQUE INDEX "ICAPE"."DEBTORS_PK" ON "ICAPE"."DEBTORS_INFO" ("ACCOUNT_CODE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 32768 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "ICAPE" ;
ALTER TABLE "ICAPE"."DEBTORS_INFO" ADD CONSTRAINT "DEBTORS_PK" PRIMARY KEY ("ACCOUNT_CODE")
  USING INDEX "ICAPE"."DEBTORS_PK"  ENABLE;

   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."COMPANY_NAME" IS 'Company name  ( for Agents)  / Branch Name (for Intercape offices)';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."IS_DEALER" IS 'Y = This is a debtors,  N = This is an Intercape office';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."ACCOUNT_CODE" IS 'Unique Identifier - this is the debtors code in SAGE.   It is also put into USER_DETAILS.STAFF_NO for each username for this debtor / branch';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."POSTAL_ADDRESS" IS 'Postal address - optional';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."STATEMENT_EMAIL" IS 'email address for statements - optional';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."STATEMENT_FAX" IS 'Not used any more';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."STATEMENT_DELIVERY" IS 'Not used';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."COMMISSION" IS 'Standard commission (as a percentage) on bus ticket sales.';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."DAYS_TO_PAY" IS 'Number of days to pay';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."M_CURRENCY" IS 'Default currency - refer CURRENCY_INFO.NAME';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."LAST_CLOSE_BALANCE" IS 'not used any more';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."LAST_CLOSE_CURRENCY" IS 'not used any more';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."LAST_CLOSE_MONTH" IS 'not used any more';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."COMMISSION_BUDGETLINER" IS 'commission for budgetliner tickets - not used any more';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."COMMISSION_SLEEPLINER" IS 'commission for sleepliner tickets - not used any more';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."CONTROLLER" IS 'not used any more';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."COUNTRY" IS 'Country - link to COUNTRY.COUNTRY_CODE';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."EXPORT_DEBTORS" IS 'Not used';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."IS_CURRENT" IS 'Y = Still current,  N = archived';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."VAT_NUMBER" IS 'VAT Number (if applicable)';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."DEBTOR_TYPE" IS 'O=Office, C=Charter/Freight Debtor, X=Other, D=DCAI,  B = Bus Ticket Agent';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."BILLING_PERIOD" IS 'M = Monthly billing (30EOS on SAGE), W = Weekly billing (07EOS on SAGE) - Note: all intercape offices are COD00 on SAGE';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."STATEMENT_DETAILS" IS 'Not used any mroe';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."ACC_CONTACT_PERSON" IS 'Contact person for accounts';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."DATE_CREATED" IS 'Date and time debtor was created';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."RELATED_PARTY" IS 'I = This is Intercape (Internal)  ,  Y = Yes, this party is related to Intercape.   N = All others.   Note - rather use SAGE_DEBTORS_TYPE in this table';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."LAST_SYNC" IS 'Date and time this master record was last synchronized to SAGE';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."SAGE_SITE" IS 'SAGE Site that "owns" the debtor, refer SITES.SITE_ID';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."CC_ACCOUNT_NO" IS 'Only for agents or offices who have an intercape credit card machine - this will point to the DEBTORS_INFO.ACCOUNT_CODE of the credit card debtor for this branch/agent.';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."COMMISSION_BAGGAGE" IS 'Commission % on baggage sales - this is used for agents who sell baggage.';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."INV_CUTOFF" IS 'Not used';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."TERMS" IS 'not used - the BILLING PERIOD column is used to determine the TERMS in SAGE';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."CREDIT_LIMIT" IS 'Credit limit - this is displaed, but not sent to SAGE and currently not used anywhere.  (Was used for trucks)';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."PAYMENT_DATE" IS 'Not used.';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."CUTOFF_DAY" IS 'Not used';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."PAYMENT_DAY" IS 'Not used.';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."NORMAL_LIMIT_APPROVED_BY" IS 'Not used.';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."SPECIAL_CREDIT_LIMIT" IS 'Not used';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."SPECIAL_LIMIT_APPROVED_BY" IS 'Not used';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."SPECIAL_LIMIT_EXPIRY_DATE" IS 'Not used';
   COMMENT ON COLUMN "ICAPE"."DEBTORS_INFO"."SHOPPING_BASKET_RESTRICTION" IS 'Not used.';

Email thing.  
1. When running /booking/debtors_alert.phtml it gets all the email address and send a msg. It need to go to the database, check for the checked thing, 
- if yes then that is the first record set. 
- Then grab the account_serial and look for a file that starts with the acc_serial, IF THERE IS then and only then send an email.  
- send email

2. The mime part is whack - check Kieth's email

STEP 1
- import the csv into debtors_info
  - need to match existing debtors and update
    - Debtor name will be be there as we are only updating the matches
	- Set the statement_reminder to NO/N/0 for the import or set to Z in testing to isolate the import
  - create a query to show the no matches

- Work on the email code
  - Find records from debtors_info WHERE statement_reminder = Y
  - Change send email thang
  -  TEST WITH MY EMAIL ADDRESS - HARD CODE IN